#pragma once

#include <sdk-meta/array.h>
#include <sdk-meta/slice.h>
#include <sdk-meta/types.h>

namespace Sdk::Crypto {

static Array<dword, 256> const CRC32_TABLE
    = { 0x0000'0000L, 0x7707'3096L, 0xee0e'612cL, 0x9909'51baL, 0x076d'c419L,
        0x706a'f48fL, 0xe963'a535L, 0x9e64'95a3L, 0x0edb'8832L, 0x79dc'b8a4L,
        0xe0d5'e91eL, 0x97d2'd988L, 0x09b6'4c2bL, 0x7eb1'7cbdL, 0xe7b8'2d07L,
        0x90bf'1d91L, 0x1db7'1064L, 0x6ab0'20f2L, 0xf3b9'7148L, 0x84be'41deL,
        0x1ada'd47dL, 0x6ddd'e4ebL, 0xf4d4'b551L, 0x83d3'85c7L, 0x136c'9856L,
        0x646b'a8c0L, 0xfd62'f97aL, 0x8a65'c9ecL, 0x1401'5c4fL, 0x6306'6cd9L,
        0xfa0f'3d63L, 0x8d08'0df5L, 0x3b6e'20c8L, 0x4c69'105eL, 0xd560'41e4L,
        0xa267'7172L, 0x3c03'e4d1L, 0x4b04'd447L, 0xd20d'85fdL, 0xa50a'b56bL,
        0x35b5'a8faL, 0x42b2'986cL, 0xdbbb'c9d6L, 0xacbc'f940L, 0x32d8'6ce3L,
        0x45df'5c75L, 0xdcd6'0dcfL, 0xabd1'3d59L, 0x26d9'30acL, 0x51de'003aL,
        0xc8d7'5180L, 0xbfd0'6116L, 0x21b4'f4b5L, 0x56b3'c423L, 0xcfba'9599L,
        0xb8bd'a50fL, 0x2802'b89eL, 0x5f05'8808L, 0xc60c'd9b2L, 0xb10b'e924L,
        0x2f6f'7c87L, 0x5868'4c11L, 0xc161'1dabL, 0xb666'2d3dL, 0x76dc'4190L,
        0x01db'7106L, 0x98d2'20bcL, 0xefd5'102aL, 0x71b1'8589L, 0x06b6'b51fL,
        0x9fbf'e4a5L, 0xe8b8'd433L, 0x7807'c9a2L, 0x0f00'f934L, 0x9609'a88eL,
        0xe10e'9818L, 0x7f6a'0dbbL, 0x086d'3d2dL, 0x9164'6c97L, 0xe663'5c01L,
        0x6b6b'51f4L, 0x1c6c'6162L, 0x8565'30d8L, 0xf262'004eL, 0x6c06'95edL,
        0x1b01'a57bL, 0x8208'f4c1L, 0xf50f'c457L, 0x65b0'd9c6L, 0x12b7'e950L,
        0x8bbe'b8eaL, 0xfcb9'887cL, 0x62dd'1ddfL, 0x15da'2d49L, 0x8cd3'7cf3L,
        0xfbd4'4c65L, 0x4db2'6158L, 0x3ab5'51ceL, 0xa3bc'0074L, 0xd4bb'30e2L,
        0x4adf'a541L, 0x3dd8'95d7L, 0xa4d1'c46dL, 0xd3d6'f4fbL, 0x4369'e96aL,
        0x346e'd9fcL, 0xad67'8846L, 0xda60'b8d0L, 0x4404'2d73L, 0x3303'1de5L,
        0xaa0a'4c5fL, 0xdd0d'7cc9L, 0x5005'713cL, 0x2702'41aaL, 0xbe0b'1010L,
        0xc90c'2086L, 0x5768'b525L, 0x206f'85b3L, 0xb966'd409L, 0xce61'e49fL,
        0x5ede'f90eL, 0x29d9'c998L, 0xb0d0'9822L, 0xc7d7'a8b4L, 0x59b3'3d17L,
        0x2eb4'0d81L, 0xb7bd'5c3bL, 0xc0ba'6cadL, 0xedb8'8320L, 0x9abf'b3b6L,
        0x03b6'e20cL, 0x74b1'd29aL, 0xead5'4739L, 0x9dd2'77afL, 0x04db'2615L,
        0x73dc'1683L, 0xe363'0b12L, 0x9464'3b84L, 0x0d6d'6a3eL, 0x7a6a'5aa8L,
        0xe40e'cf0bL, 0x9309'ff9dL, 0x0a00'ae27L, 0x7d07'9eb1L, 0xf00f'9344L,
        0x8708'a3d2L, 0x1e01'f268L, 0x6906'c2feL, 0xf762'575dL, 0x8065'67cbL,
        0x196c'3671L, 0x6e6b'06e7L, 0xfed4'1b76L, 0x89d3'2be0L, 0x10da'7a5aL,
        0x67dd'4accL, 0xf9b9'df6fL, 0x8ebe'eff9L, 0x17b7'be43L, 0x60b0'8ed5L,
        0xd6d6'a3e8L, 0xa1d1'937eL, 0x38d8'c2c4L, 0x4fdf'f252L, 0xd1bb'67f1L,
        0xa6bc'5767L, 0x3fb5'06ddL, 0x48b2'364bL, 0xd80d'2bdaL, 0xaf0a'1b4cL,
        0x3603'4af6L, 0x4104'7a60L, 0xdf60'efc3L, 0xa867'df55L, 0x316e'8eefL,
        0x4669'be79L, 0xcb61'b38cL, 0xbc66'831aL, 0x256f'd2a0L, 0x5268'e236L,
        0xcc0c'7795L, 0xbb0b'4703L, 0x2202'16b9L, 0x5505'262fL, 0xc5ba'3bbeL,
        0xb2bd'0b28L, 0x2bb4'5a92L, 0x5cb3'6a04L, 0xc2d7'ffa7L, 0xb5d0'cf31L,
        0x2cd9'9e8bL, 0x5bde'ae1dL, 0x9b64'c2b0L, 0xec63'f226L, 0x756a'a39cL,
        0x026d'930aL, 0x9c09'06a9L, 0xeb0e'363fL, 0x7207'6785L, 0x0500'5713L,
        0x95bf'4a82L, 0xe2b8'7a14L, 0x7bb1'2baeL, 0x0cb6'1b38L, 0x92d2'8e9bL,
        0xe5d5'be0dL, 0x7cdc'efb7L, 0x0bdb'df21L, 0x86d3'd2d4L, 0xf1d4'e242L,
        0x68dd'b3f8L, 0x1fda'836eL, 0x81be'16cdL, 0xf6b9'265bL, 0x6fb0'77e1L,
        0x18b7'4777L, 0x8808'5ae6L, 0xff0f'6a70L, 0x6606'3bcaL, 0x1101'0b5cL,
        0x8f65'9effL, 0xf862'ae69L, 0x616b'ffd3L, 0x166c'cf45L, 0xa00a'e278L,
        0xd70d'd2eeL, 0x4e04'8354L, 0x3903'b3c2L, 0xa767'2661L, 0xd060'16f7L,
        0x4969'474dL, 0x3e6e'77dbL, 0xaed1'6a4aL, 0xd9d6'5adcL, 0x40df'0b66L,
        0x37d8'3bf0L, 0xa9bc'ae53L, 0xdebb'9ec5L, 0x47b2'cf7fL, 0x30b5'ffe9L,
        0xbdbd'f21cL, 0xcaba'c28aL, 0x53b3'9330L, 0x24b4'a3a6L, 0xbad0'3605L,
        0xcdd7'0693L, 0x54de'5729L, 0x23d9'67bfL, 0xb366'7a2eL, 0xc461'4ab8L,
        0x5d68'1b02L, 0x2a6f'2b94L, 0xb40b'be37L, 0xc30c'8ea1L, 0x5a05'df1bL,
        0x2d02'ef8dL };

u32 crc32(Bytes data, u32 seed = 0xFFFF'FFFF) {
    u32 crc         = seed ^ 0xFFFF'FFFF;
    auto [buf, len] = data;

    for (usize i = 0; i < len; i++)
        crc = CRC32_TABLE[(crc ^ buf[i]) & 0xFF] ^ (crc >> 8);

    return crc ^ 0xFFFF'FFFF;
}

} // namespace Sdk::Crypto
